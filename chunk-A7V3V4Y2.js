import{L as d,P as c,c as o,gb as f}from"./chunk-FCD34S5F.js";var h=class s{authService=c(f);FOLDER_NAME="notes-app-data";FILE_NAME="notes-app-data.json";folderId=null;fileId=null;initializeFolderAndFile(t){return o(this,null,function*(){this.folderId||(this.folderId=yield this.findOrCreateFolder(t)),!this.fileId&&this.folderId&&(this.fileId=yield this.findOrCreateFile(t))})}findOrCreateFolder(t){return o(this,null,function*(){try{let e=yield(yield fetch(`https://www.googleapis.com/drive/v3/files?q=name='${this.FOLDER_NAME}' and mimeType='application/vnd.google-apps.folder' and trashed=false`,{headers:{Authorization:`Bearer ${t}`}})).json();if(e.files&&e.files.length>0)return e.files[0].id;let i=yield fetch("https://www.googleapis.com/drive/v3/files",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({name:this.FOLDER_NAME,mimeType:"application/vnd.google-apps.folder"})});if(!i.ok)throw new Error("Failed to create folder in Google Drive");return(yield i.json()).id}catch(r){throw console.error("Error finding/creating folder:",r),r}})}findOrCreateFile(t){return o(this,null,function*(){if(!this.folderId)throw new Error("Folder ID not initialized");try{let e=yield(yield fetch(`https://www.googleapis.com/drive/v3/files?q=name='${this.FILE_NAME}' and '${this.folderId}' in parents and trashed=false`,{headers:{Authorization:`Bearer ${t}`}})).json();return e.files&&e.files.length>0?e.files[0].id:null}catch(r){return console.error("Error finding file:",r),null}})}syncToDrive(t,r){return o(this,null,function*(){if(!this.authService.isSignedIn())throw new Error("User not signed in");let e=this.authService.getAccessToken();if(!e)throw new Error("No access token available");yield this.initializeFolderAndFile(e);let i={notes:t,categories:r,lastSynced:new Date().toISOString()},a=JSON.stringify(i,null,2),l=new Blob([a],{type:"application/json"});try{this.fileId?yield this.updateFile(this.fileId,l,e):this.fileId=yield this.createFile(l,e)}catch(n){throw console.error("Error syncing to Google Drive:",n),n}})}syncFromDrive(){return o(this,null,function*(){if(!this.authService.isSignedIn())throw new Error("User not signed in");let t=this.authService.getAccessToken();if(!t)throw new Error("No access token available");try{if(yield this.initializeFolderAndFile(t),!this.fileId)return null;let r=yield this.downloadFile(this.fileId,t),e=JSON.parse(r);return{notes:e.notes||[],categories:e.categories||[]}}catch(r){throw console.error("Error syncing from Google Drive:",r),r}})}createFile(t,r){return o(this,null,function*(){if(!this.folderId)throw new Error("Folder ID not initialized");let e={name:this.FILE_NAME,mimeType:"application/json",parents:[this.folderId]},i=new FormData;i.append("metadata",new Blob([JSON.stringify(e)],{type:"application/json"})),i.append("file",t);let a=yield fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart",{method:"POST",headers:{Authorization:`Bearer ${r}`},body:i});if(!a.ok){let n=yield a.text();throw console.error("Create file error:",n),new Error("Failed to create file in Google Drive")}return(yield a.json()).id})}updateFile(t,r,e){return o(this,null,function*(){let i=yield fetch(`https://www.googleapis.com/upload/drive/v3/files/${t}?uploadType=media`,{method:"PATCH",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:r});if(!i.ok){let a=yield i.text();throw console.error("Update file error:",a),new Error("Failed to update file in Google Drive")}})}downloadFile(t,r){return o(this,null,function*(){let e=yield fetch(`https://www.googleapis.com/drive/v3/files/${t}?alt=media`,{headers:{Authorization:`Bearer ${r}`}});if(!e.ok){let i=yield e.text();throw console.error("Download file error:",i),new Error("Failed to download file from Google Drive")}return yield e.text()})}static \u0275fac=function(r){return new(r||s)};static \u0275prov=d({token:s,factory:s.\u0275fac,providedIn:"root"})};export{h as a};
