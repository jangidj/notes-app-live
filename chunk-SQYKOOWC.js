import{K as S,O as u,Z as d,a as o,b as g,nb as y}from"./chunk-HVD5NXG4.js";var h=class l{authService=u(y);notesSignal=d([]);categoriesSignal=d([]);notes=this.notesSignal.asReadonly();categories=this.categoriesSignal.asReadonly();NOTES_KEY_PREFIX="notes_app_notes_";CATEGORIES_KEY_PREFIX="notes_app_categories_";constructor(){}getStorageKeys(e){let t=e?e.replace(/[^a-zA-Z0-9]/g,"_"):"guest";return{notesKey:`${this.NOTES_KEY_PREFIX}${t}`,categoriesKey:`${this.CATEGORIES_KEY_PREFIX}${t}`}}loadFromStorage(e=null){let t=e||this.authService.currentUser()?.email||null,{notesKey:a,categoriesKey:s}=this.getStorageKeys(t),i=localStorage.getItem(a),r=localStorage.getItem(s);if(i){let c=JSON.parse(i).map(n=>g(o({},n),{createdAt:new Date(n.createdAt),updatedAt:new Date(n.updatedAt),lastSyncedAt:n.lastSyncedAt?new Date(n.lastSyncedAt):void 0,needsSync:n.needsSync??!1}));this.notesSignal.set(c)}else this.notesSignal.set([]);if(r){let c=JSON.parse(r).map(n=>g(o({},n),{createdAt:new Date(n.createdAt),lastSyncedAt:n.lastSyncedAt?new Date(n.lastSyncedAt):void 0,needsSync:n.needsSync??!1}));this.categoriesSignal.set(c)}else this.categoriesSignal.set([]);this.initializeDefaultCategories()}saveToStorage(){let e=this.authService.currentUser()?.email||null,{notesKey:t,categoriesKey:a}=this.getStorageKeys(e);localStorage.setItem(t,JSON.stringify(this.notesSignal())),localStorage.setItem(a,JSON.stringify(this.categoriesSignal()))}clearCurrentUserData(){this.notesSignal.set([]),this.categoriesSignal.set([])}setNotesAndCategories(e,t){this.notesSignal.set(e.map(a=>g(o({},a),{needsSync:!1}))),this.categoriesSignal.set(t.map(a=>g(o({},a),{needsSync:!1}))),this.saveToStorage()}initializeDefaultCategories(){if(this.categoriesSignal().length===0){let e=[{id:"1",name:"Personal",color:"#4CAF50",createdAt:new Date},{id:"2",name:"Work",color:"#2196F3",createdAt:new Date},{id:"3",name:"Ideas",color:"#FF9800",createdAt:new Date},{id:"4",name:"Shopping",color:"#9C27B0",createdAt:new Date}];this.categoriesSignal.set(e),this.saveToStorage()}}getNoteById(e){return this.notesSignal().find(t=>t.id===e)}getNotesByCategory(e){return this.notesSignal().filter(t=>t.categoryId===e)}searchNotes(e){let t=e.toLowerCase();return this.notesSignal().filter(a=>a.title.toLowerCase().includes(t)||a.content.toLowerCase().includes(t)||a.tags?.some(s=>s.toLowerCase().includes(t)))}createNote(e){let t=g(o({},e),{id:this.generateId(),createdAt:new Date,updatedAt:new Date,needsSync:!0});return this.notesSignal.update(a=>[...a,t]),this.saveToStorage(),t}updateNote(e,t){let a=this.getNoteById(e);if(!a)return null;let s=g(o(o({},a),t),{id:e,updatedAt:new Date,needsSync:!0});return this.notesSignal.update(i=>i.map(r=>r.id===e?s:r)),this.saveToStorage(),s}deleteNote(e){return this.notesSignal().some(a=>a.id===e)?(this.notesSignal.update(a=>a.filter(s=>s.id!==e)),this.saveToStorage(),!0):!1}getCategoryById(e){return this.categoriesSignal().find(t=>t.id===e)}createCategory(e){let t=g(o({},e),{id:this.generateId(),createdAt:new Date,needsSync:!0});return this.categoriesSignal.update(a=>[...a,t]),this.saveToStorage(),t}updateCategory(e,t){let a=this.getCategoryById(e);if(!a)return null;let s=g(o(o({},a),t),{id:e,needsSync:!0});return this.categoriesSignal.update(i=>i.map(r=>r.id===e?s:r)),this.notesSignal.update(i=>i.map(r=>r.categoryId===e?g(o({},r),{categoryName:s.name,needsSync:!0}):r)),this.saveToStorage(),s}deleteCategory(e){return this.notesSignal().some(s=>s.categoryId===e)?!1:this.categoriesSignal().some(s=>s.id===e)?(this.categoriesSignal.update(s=>s.filter(i=>i.id!==e)),this.saveToStorage(),!0):!1}generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}static \u0275fac=function(t){return new(t||l)};static \u0275prov=S({token:l,factory:l.\u0275fac,providedIn:"root"})};export{h as a};
